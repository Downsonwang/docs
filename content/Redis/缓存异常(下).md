
```json
{
 "date": "2024.03.15 21:50",
  "tags":["缓存"],
  "title": "三大缓存问题"
}
```

#### 缓存异常

缓存雪崩、缓存击穿和缓存穿透

#### 缓存雪崩

缓存雪崩是指大量的应用请求无法在 Redis 缓存中进行处理，紧接着，应用将大量请求发送到数据库层，导致数据库层的压力激增。


原因一: 缓存中有大量数据同时过期,导致大量请求无法处理。

解决方案一: 避免大量数据设置相同过期时间。EXPIRE命令给数据设置过期时间时给这些数据加一个较小的随机数。

解决方案二: 服务降级,当业务应用访问的是非核心数据（例如电商商品属性）时，暂时停止从缓存中查询这些数据，而是直接返回预定义信息、空值或是错误信息；当业务应用访问的是核心数据（例如电商商品库存）时，仍然允许查询缓存，如果缓存缺失，也可以继续通过数据库读取。这样一来，只有部分过期数据的请求会发送到数据库，数据库的压力就没有那么大了。

原因二: 缓存实例发生故障当即了,无法处理请求。

解决方案一: 在业务系统中实现服务熔断或请求限流。 限制请求qps
解决方案二: 通过主从节点的方式构建 Redis 缓存高可靠集群。如果 Redis 缓存的主节点故障宕机了，从节点还可以切换成为主节点，继续提供缓存服务，避免了由于缓存实例宕机而导致的缓存雪崩问题。

#### 缓存击穿

缓存击穿是指 针对某个访问非常频繁的热点数据的请求，无法在缓存中进行处理，紧接着，访问该数据的大量请求，一下子都发送到了后端数据库，导致了数据库压力激增，会影响数据库处理其他请求。缓存击穿的情况，经常发生在热点数据过期失效时。

为了避免缓存击穿给数据库带来的激增压力: 对于热点缓存可以再多设置一个status的key，这个key设置过期时间，但是真正存放数据的data的key，可以不设置过期时间。
应用在读取data的key之前，先读取status这个key，如果status的key过期了，只需要一个线程去更新data并重新设置status的key，而其他线程都直接返回data的key给客户端。这样最多只有一个线程的请求会到达数据库，不会发生大量请求打到数据库的情况。这就避免给数据库造成太大的压力。


#### 缓存穿透
缓存穿透是指要访问的数据既不在 Redis 缓存中，也不在数据库中，导致请求在访问缓存时，发生缓存缺失，再去访问数据库时，发现数据库中也没有要访问的数据。

缓存穿透会发生在什么时候呢？一般来说，有两种情况。
业务层误操作：缓存中的数据和数据库中的数据被误删除了，所以缓存和数据库中都没有数据；
恶意攻击：专门访问数据库中没有的数据。

第一种方案是，缓存空值或缺省值。

第二种方案是，使用布隆过滤器快速判断数据是否存在，避免从数据库中查询数据是否存在，减轻数据库压力。







