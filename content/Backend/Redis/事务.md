## 事务简介
什么是事务: Redis执行指令过程中,多条连续执行的指令被干扰,打断,插队。一个命令执行的队列,将一系列预定义命令包装成一个整体(一个队列)。当执行时,一次性按照添加顺序依次执行,中间不会被打断或者干扰。

## 事务基本操作
```
multi - 开启事务
discard - 取消事务

exec - 与multi共同执行 
```

## 事务的注意事项
- 定义事务过程中,命令格式输入错误怎么办?
    - 指令书写格式有误
    - 如果定义的事务中包含的命令存在语法错误,整体事务所有命令均不会执行
    
- 定义事务过程中,命令执行出现错误怎么办?
    - 能够正常运行的正常运行,不能的直接不能执行
   
- 已经执行完毕的命令对应的数据不会自动回避,需要在代码中自动回滚。


 
- 手动进行事务回滚
   - 记录操作过程中被影响数据之前的状态
     单数据:string , 多数据:hash list set zset
   - 设置指令恢复所有的被修改项
     单数据:直接set , 多数据:修改对应值或整体克隆复制
- 基于特定条件的事务执行——锁
  -  对key锁添加监视锁,在执行exec前如果key发生变化,终止事务执行。
  在开启事务之前监控
  ```
   watch key1 [key2]...
 ```
-  取消对key的监视
```
  unwatch key1 [key2]
```


基于特定条件的事务执行 - 分布式锁
```
setnx lock-key value

利用setnx命令的返回值特征,有值返回失败,无值返回成功
```

- 使用expire为锁key添加时间限定,到时不释放,放弃锁
```
expire lock-key second
pexpire lock-key milliseconds

```

## 数据删除策略
在内存占用与CPU占用之间寻找一种平衡,顾此失彼都会造成redis性能下降,甚至引发服务器宕机或内存泄露

- 定时删除 ： 节约内存,无占用   - 拿时间换空间
- 惰性删除 :     内存占用严重    - 拿空间换时间
- 定期删除 :    内存定期随机清理 - 随机抽查,重点抽查


